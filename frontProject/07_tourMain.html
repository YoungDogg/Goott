<!DOCTYPE html>
<html>

    <head>
        <title>Bootstrap Example</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .tourImg {
                max-width: 50%;
                float: left;
            }

            .tourTitle {
                /* float: right; */
                text-align: center;
            }

            .tourItem {
                overflow: auto;
            }

            /* @media screen and (min-width: 480px) {

                480 < 브라우저이면
                .tourItem {
                    margin: 5px;
                    border: 1px solid #ccc;
                    overflow: auto;
                    width: 200px;
                }

                .tourImg {
                    margin: auto 0;
                    max-width: 50%;
                    float: left;
                }

                .tourTitle {
                    text-align: center;
                    padding: 20px;
                }
            } */
        </style>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script>
            let output = "";
            let totalCnt = 0;
            let pageNo = 1, numOfRows = 10;
            let key = "096619f23ef94cad834f252aeb89bc16";

            $(function () {
                // console.log("pageNo");
                // console.log(pageNo);
                getXml(pageNo);
            })

            //xml파일을 받아온다 매개변수: 도시선택, 온도종류선택
            function getXml(pageNo) {
                let xhhtp = new XMLHttpRequest();   //create ajax object
                if (xhhtp != null) {
                    // connection prepared...
                    xhhtp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) {
                            // console.log("pageNo inside of getXml()");
                            // console.log(pageNo);
                            xmlParsing(this.responseXML, pageNo);
                        } else {  //not connected                            
                            // console.log('failed to connect');
                        }
                    }
                    let dataUrl = "https://openapi.gg.go.kr/FarmingExperienceVillage?key=" + key + "&pIndex=" + pageNo + "&pSize=" + numOfRows;
                    xhhtp.open("GET", dataUrl);
                    xhhtp.send();
                } else {
                    alert('no Ajax support in this web browser');
                }
            };

            function xmlParsing(xmlDoc, pageNo) {
                
                let farmName, farmViliName, farmOwner, farmPhone, farmHomepage, farmAdrss, farmZipcode, farmLogt, farmLat, farmImg;
                let farArr = xmlDoc.getElementsByTagName('row');
                totalCnt = xmlDoc.getElementsByTagName('head')[0].getElementsByTagName('list_total_count')[0].textContent;
                                
                output = "";
                for (let i = 0; i < farArr.length; i++) {   //0부터가 아니라 그 전부터 해야 한다.                         
                    farmViliName = farArr[i].getElementsByTagName('EXPRN_VILAGE_NM')[0].textContent;
                    farmName = farArr[i].getElementsByTagName('MANAGE_INST_NM')[0].textContent;
                    farmOwner = farArr[i].getElementsByTagName('REPRSNTV_NM')[0].textContent;
                    farmPhone = farArr[i].getElementsByTagName('REPRSNT_TELNO')[0].textContent;
                    farmHomepage = farArr[i].getElementsByTagName('HMPG_ADDR')[0].textContent;
                    farmAdrss = farArr[i].getElementsByTagName('REFINE_LOTNO_ADDR')[0].textContent;
                    farmZipcode = farArr[i].getElementsByTagName('REFINE_ZIP_CD')[0].textContent;
                    farmLogt = farArr[i].getElementsByTagName('REFINE_WGS84_LOGT')[0].textContent;
                    farmLat = farArr[i].getElementsByTagName('REFINE_WGS84_LAT')[0].textContent;
                    farmImg = farArr[i].getElementsByTagName('EXPRN_VILAGE_PHOTO_INFO')[0].textContent;
                    
                    
                    output += "<h4 class='titleC'> 체험장 이름 : " + farmViliName + "</h4>";
                    output += "<h4 class='titleC'> 농장주 : " + farmOwner + "</h4>";
                    output += "<h4 class='titleC'> 전화번호 : " + farmPhone + "</h4>";
                    output += "<h4 class='titleC'> 홈페이지 : " + farmHomepage + "</h4>";
                    output += "<h4 class='titleC'> 주소 : " + farmAdrss + "</h4>";
                    output += "<h4 class='titleC'> 우편번호 : " + farmZipcode + "</h4>";
                    output += "<h4 class='titleC'> 위도 longitude : " + farmLogt + "</h4>";
                    output += "<h4 class='titleC'> 적도 latitude : " + farmLat + "</h4>";
                    output += "<h4 class='titleC'> Image : " + farmImg + "</h4>";
                }
                // output = "</div>";

                output += '<button id="btnMore" type="button" class="btn btn-block" onclick="more(' + totalCnt + ', ' + pageNo + ', ' + numOfRows + ',this)"> 더보기</button>';
                $(".container").append(output); //줄줄이 나온다                    
                // $(".container").html(output); //줄줄이 나온다                    
                // document.getElementById(".container").innerHTML = output;                    
            }

            //버튼 누르면
            function more(totalCnt, pageNo, numOfRows, obj) {
                $(obj).remove();

                //total 가져오기                
                // 전체 / 페이지 = 페이지 수, 올림한다. +1 하려고
                let totalPage = Math.ceil(totalCnt / numOfRows);
                // console.log(totalPage, pageNo);

                pageNo++; //페이지 증가
                if (pageNo <= totalPage) {
                    // console.log("pageNo inside of more()");
                    // console.log(pageNo);
                    getXml(pageNo);
                }
                else { alert('마지막 페이지') };

                // dataLoading(totalPage);
            }
        </script>
    </head>

    <body>
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">WebSiteName</a>
                </div>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">Page 1</a></li>
                    <li><a href="#">Page 2</a></li>
                    <li><a href="#">Page 3</a></li>
                </ul>
            </div>
        </nav>
        <div class="jumbotron text-center">
            <div class="container">
                <div id="output"></div>
            </div>
        </div>
        </div>
    </body>

</html>